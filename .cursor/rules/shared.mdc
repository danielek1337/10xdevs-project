---
description: Core rules and guidelines for VibeCheck application
globs: 
alwaysApply: true
---
# AI Rules for VibeCheck

VibeCheck is a productivity tracking application that helps developers monitor their flow state and productivity levels throughout the day. Users can log their mood, tasks, and focus levels, with automatic calculation of daily productivity metrics.

**Authentication Required:** The application requires users to create an account and log in to access all features. Unauthenticated users can only view the landing page with login/signup options.

## Tech Stack

- Astro 5
- TypeScript 5
- React 19
- Tailwind 4
- Shadcn/ui
- Supabase (Auth + Database + RLS)
- Playwright (E2E testing)dn
- Vitest (Unit testing)
- GitHub Actions (CI/CD)
- Vercel (Deployment)

## Project Structure

When introducing changes to the project, always follow the directory structure below:

- `./src` - source code
- `./src/layouts` - Astro layouts
- `./src/pages` - Astro pages
- `./src/pages/api` - API endpoints
- `./src/middleware/index.ts` - Astro middleware
- `./src/db` - Supabase clients and types
- `./src/types.ts` - Shared types for backend and frontend (Entities, DTOs)
- `./src/components` - Client-side components written in Astro (static) and React (dynamic)
- `./src/components/ui` - Client-side components from Shadcn/ui
- `./src/lib` - Services and helpers 
- `./src/assets` - static internal assets
- `./public` - public assets

When modifying the directory structure, always update this section.

## Core Features & Requirements

### Authentication & Access Control

- **Authentication Required:** All application features require user authentication
- Landing page (`/`) is public and displays welcome message with login/signup options
- Dashboard (`/dashboard`) and all other pages require active authentication session
- Use Supabase Auth with Email/Password authentication only
- No external OAuth providers (Google, GitHub, etc.)
- Implement Row Level Security (RLS) to ensure users can only access their own entries
- All database queries must respect RLS policies
- Protect API endpoints with authentication middleware
- Middleware redirects unauthenticated users to landing page
- Password recovery functionality must be available

### Data Management (CRUD Operations)

#### Create
- Add new productivity entry with:
  - Mood rating (1-5 scale)
  - Task description
  - Tags for categorization
  - Automatic timestamp

#### Read
- Dashboard displaying history of all user entries
- Filter and sort capabilities by date, mood, tags
- Visual representation of productivity trends

#### Update
- Allow editing notes/descriptions of existing entries
- Preserve original timestamp and metadata

#### Delete
- Remove incorrect or unwanted log entries
- Soft delete option for data recovery

### Business Logic

#### Daily Focus Score Calculation
- Automatically calculate "Daily Focus Score" based on:
  - Mood ratings from entries throughout the day
  - Frequency of entries (consistency indicator)
  - Time distribution of productive periods
- Score should be recalculated when entries are added/updated/deleted

#### Validation Rules
- Anti-spam: Maximum one entry per hour per user
- Mood rating must be between 1-5
- Task description required (min 3 characters)
- Tags must follow allowed format (alphanumeric, max 20 chars each)

#### Data Formatting
- Format work time into readable statistics (hours, minutes)
- Display timestamps in user-friendly format
- Calculate time gaps between entries
- Generate daily/weekly/monthly summaries

### Testing Requirements

#### Unit Tests (Vitest)
- Test Daily Focus Score calculation function with various inputs
- Test validation functions (anti-spam, mood range, etc.)
- Test data formatting utilities
- Test business logic edge cases

#### E2E Tests (Playwright)
- Test complete authentication flow (signup, login, logout)
- Test creating a new productivity entry
- Test editing and deleting entries
- Test dashboard data display
- Test that users cannot access other users' data

### CI/CD Pipeline

#### GitHub Actions Workflow
- Run on every push to any branch
- Execute all unit tests (Vitest)
- Execute all E2E tests (Playwright)
- Check TypeScript compilation
- Run ESLint for code quality
- Automatic deployment to Vercel on main branch (only if all tests pass)
- Generate test coverage reports

## Coding practices

### Guidelines for clean code

- Use feedback from linters to improve the code when making changes.
- Prioritize error handling and edge cases.
- Handle errors and edge cases at the beginning of functions.
- Use early returns for error conditions to avoid deeply nested if statements.
- Place the happy path last in the function for improved readability.
- Avoid unnecessary else statements; use if-return pattern instead.
- Use guard clauses to handle preconditions and invalid states early.
- Implement proper error logging and user-friendly error messages.
- Consider using custom error types or error factories for consistent error handling.
